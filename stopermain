// Definicje:
// Atmegas32 posiada dwa Timery 8 i 16 bitów
// Preskaler - wew dzielnik czestotliwosci taktowania dostarczanej do taktowania timera
// Tryb pracy Timer0 ustawaimy na CTC -> licznik Timer0 w trakcie zliczania bedzie porównywany z wartoscia rejestru OCR0 (Compare Match), jeżeli równe to przerwanie
// OCR0 8 bitów czyli zakres 0-255   OCR0 = (8000000Hz/1024preskaler/200Hz)-1 =38.06    przerwania co 200Hz     38 jest w zbiorze 0-255

#include <avr/io.h>				// dołączenie głównego systemowego  pliku nagłówkowego
#include <avr/interrupt.h>
#include <util/delay.h>
#include "d_led.h"				// dołączenie naszego pliku nagłówkowego (obsługa LED)

int main(void){
	
	// ****** inicjalizacja *********
	d_led_init();   		// inicjalizacja wyświetlacza multipleksowanego
	sei();		         	// włączenie globalnego zezwolenia na przerwania

	uint16_t licznik=0;
	uint8_t d1,d2,d3,d4;

	
		while(1){
			licznik++;

			d1=licznik/1000;
			if(d1) cy1=d1; else cy1=NIC;
			d2=(licznik-(d1*1000))/100;
			if(d2) cy2=d2; else cy2=(licznik>999)?0:NIC;
			d3=(licznik-(d1*1000)-(d2*100))/10;
			if(d3) cy3=d3; else cy3=(licznik>99)?0:NIC;
			d4=(licznik-(d1*1000)-(d2*100)-(d3*10));
			cy4=d4;
			_delay_ms(100);
			 //if(licznik>99) licznik=0;
			//if(!licznik) licznik=6000;
		}
}

